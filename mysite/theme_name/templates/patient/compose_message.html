{% extends "patient/base.html" %}
{% block title %}Compose Message - Northern Health Innovations{% endblock %}
{% block content %}
<div class="flex justify-between items-center mb-6">
  <h2 class="text-xl font-bold text-gray-800">Compose New Message</h2>
  <a href="{% if user.is_staff %}{% url 'provider_messages' %}{% else %}{% url 'patient_messages' %}{% endif %}" class="text-[#004d40] hover:text-[#00332e] py-2 px-4 rounded-lg flex items-center">
    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
    </svg>
    Back to Messages
  </a>
</div>

<div class="bg-white p-6 rounded-xl shadow mb-8">
  <form method="post" class="space-y-6">
    {% csrf_token %}
    
    {% if form.non_field_errors %}
    <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert">
      {% for error in form.non_field_errors %}
        <p>{{ error }}</p>
      {% endfor %}
    </div>
    {% endif %}
    
    <!-- Recipient field - different for patients and providers -->
    <div>
      {% if user.is_staff %}
      <label for="{{ form.recipient.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Recipient:</label>
      {{ form.recipient }}
      {% if form.recipient.errors %}
      <p class="mt-2 text-sm text-red-600">
        {% for error in form.recipient.errors %}{{ error }}{% endfor %}
      </p>
      {% endif %}
      {% else %}
      <label for="{{ form.recipient_type.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Send To:</label>
      {{ form.recipient_type }}
      {% if form.recipient_type.errors %}
      <p class="mt-2 text-sm text-red-600">
        {% for error in form.recipient_type.errors %}{{ error }}{% endfor %}
      </p>
      {% endif %}
      {% endif %}
    </div>
    
    <!-- Subject field -->
    <div>
      <label for="{{ form.subject.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Subject:</label>
      {{ form.subject }}
      {% if form.subject.errors %}
      <p class="mt-2 text-sm text-red-600">
        {% for error in form.subject.errors %}{{ error }}{% endfor %}
      </p>
      {% endif %}
    </div>
    
    <!-- Message content field -->
    <div>
      <label for="{{ form.content.id_for_label }}" class="block text-sm font-medium text-gray-700 mb-1">Message:</label>
      {{ form.content }}
      {% if form.content.errors %}
      <p class="mt-2 text-sm text-red-600">
        {% for error in form.content.errors %}{{ error }}{% endfor %}
      </p>
      {% endif %}
    </div>
    
    <!-- Submit button -->
    <div class="flex justify-end">
      <button type="submit" class="bg-[#004d40] hover:bg-[#00332e] text-white py-2 px-4 rounded-lg flex items-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
        </svg>
        Send Message
      </button>
    </div>
  </form>
</div>
{% endblock %}
