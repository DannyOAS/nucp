{% extends "base.html" %}

{% block title %}Patient Registration - Northern Health Innovations{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-6xl">

    <!-- Registration Header -->
    <div class="text-center mb-8">
        <h1 class="text-4xl font-extrabold text-[#004d40]">Patient Registration</h1>
        <p class="mt-4 text-lg text-gray-600 max-w-3xl mx-auto">
            Please complete this registration form for virtual care services.
        </p>
    </div>

    <!-- Progress Indicator -->
    <div class="max-w-4xl mx-auto mb-8">
        <div class="flex justify-between">
            <span class="text-[#004d40] font-medium">General Info</span>
            <span class="text-[#004d40] font-medium">Medical Info</span>
            <span class="text-[#004d40] font-medium">Emergency Contact</span>
            <span class="text-[#004d40] font-medium">Consent</span>
        </div>
        <div class="mt-2 h-2 bg-gray-200 rounded-full overflow-hidden">
            <div class="h-full bg-[#004d40] rounded-full" style="width: 0%" id="progress-bar"></div>
        </div>
    </div>

    <!-- Success Message -->
    {% if messages %}
        <div class="mb-6 flex justify-center">
            {% for message in messages %}
                <div id="success-message" class="relative w-full max-w-3xl px-6 py-4 rounded-lg shadow-md text-center font-semibold flex items-center justify-center"
                     style="background-color: #004d40; color: white; border: 1px solid #00332e; transition: opacity 0.5s ease-in-out;">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    {{ message }}
                </div>
            {% endfor %}
        </div>
    {% endif %}

    <!-- Registration Form in Cards -->
    <form method="POST" class="max-w-4xl mx-auto" id="registration-form">
        {% csrf_token %}

        <!-- 1. General Information Section -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8" id="section-1">
            <div class="bg-[#004d40] px-6 py-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z" />
                </svg>
                <h2 class="text-xl font-bold text-white">General Information</h2>
            </div>
            
            <div class="p-6 bg-gray-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">First Name</label>
                        {{ form.first_name }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Last Name</label>
                        {{ form.last_name }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Primary Phone</label>
                        {{ form.primary_phone }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Alternate Phone</label>
                        {{ form.alternate_phone }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Email</label>
                        {{ form.email }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Date of Birth</label>
                        {{ form.date_of_birth }}
                    </div>

                    <div class="space-y-2 md:col-span-2">
                        <label class="block text-gray-700 font-semibold">Address</label>
                        {{ form.address }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">OHIP Number</label>
                        {{ form.ohip_number }}
                    </div>
                </div>
                
                <div class="mt-6 flex justify-end">
                    <button type="button" class="bg-[#004d40] text-white px-6 py-2 rounded-lg hover:bg-[#00332e] transition-all duration-200" onclick="nextSection(1)">
                        Next
                    </button>
                </div>
            </div>
        </div>

        <!-- 2. Medical Information Section -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8 hidden" id="section-2">
            <div class="bg-[#004d40] px-6 py-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0016.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 002 8.5c0 2.3 1.5 4.05 3 5.5l7 7z" />
                </svg>
                <h2 class="text-xl font-bold text-white">Medical Information</h2>
            </div>
            
            <div class="p-6 bg-gray-50">
                <div class="space-y-6">
                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Current Medications</label>
                        {{ form.current_medications }}
                        <p class="text-gray-500 text-sm mt-1">List all current medications and dosages</p>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Allergies</label>
                        {{ form.allergies }}
                        <p class="text-gray-500 text-sm mt-1">Include drug, food, and environmental allergies</p>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Supplements</label>
                        {{ form.supplements }}
                        <p class="text-gray-500 text-sm mt-1">List vitamins, minerals and other supplements</p>
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Pharmacy Details</label>
                        {{ form.pharmacy_details }}
                        <p class="text-gray-500 text-sm mt-1">Include preferred pharmacy name and location</p>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-between">
                    <button type="button" class="border border-[#004d40] text-[#004d40] px-6 py-2 rounded-lg hover:bg-gray-100 transition-all duration-200" onclick="prevSection(2)">
                        Previous
                    </button>
                    <button type="button" class="bg-[#004d40] text-white px-6 py-2 rounded-lg hover:bg-[#00332e] transition-all duration-200" onclick="nextSection(2)">
                        Next
                    </button>
                </div>
            </div>
        </div>

        <!-- 3. Emergency Contact Section -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8 hidden" id="section-3">
            <div class="bg-[#004d40] px-6 py-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18.364 5.636l-3.536 3.536m0 5.656l3.536 3.536M9.172 9.172L5.636 5.636m3.536 9.192l-3.536 3.536M21 12a9 9 0 11-18 0 9 9 0 0118 0zm-5 0a4 4 0 11-8 0 4 4 0 018 0z" />
                </svg>
                <h2 class="text-xl font-bold text-white">Emergency Contact</h2>
            </div>
            
            <div class="p-6 bg-gray-50">
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="space-y-2 md:col-span-2">
                        <label class="block text-gray-700 font-semibold">Name</label>
                        {{ form.emergency_contact_name }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Phone</label>
                        {{ form.emergency_contact_phone }}
                    </div>

                    <div class="space-y-2">
                        <label class="block text-gray-700 font-semibold">Alternate Phone</label>
                        {{ form.emergency_contact_alternate_phone }}
                    </div>
                </div>
                
                <div class="mt-6 flex justify-between">
                    <button type="button" class="border border-[#004d40] text-[#004d40] px-6 py-2 rounded-lg hover:bg-gray-100 transition-all duration-200" onclick="prevSection(3)">
                        Previous
                    </button>
                    <button type="button" class="bg-[#004d40] text-white px-6 py-2 rounded-lg hover:bg-[#00332e] transition-all duration-200" onclick="nextSection(3)">
                        Next
                    </button>
                </div>
            </div>
        </div>

        <!-- 4. Consent Section -->
        <div class="bg-white rounded-xl shadow-md overflow-hidden mb-8 hidden" id="section-4">
            <div class="bg-[#004d40] px-6 py-4 flex items-center">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
                </svg>
                <h2 class="text-xl font-bold text-white">Consent</h2>
            </div>
            
            <div class="p-6 bg-gray-50">
                <div class="space-y-6">
                    <div class="p-4 bg-white rounded-lg border border-gray-200">
                        <h3 class="font-semibold text-[#004d40] mb-2">Virtual Care Consent</h3>
                        <p class="text-gray-600 mb-4 text-sm">
                            I consent to receive healthcare services via secure video conferencing. I understand that virtual care has limitations compared to in-person visits, and that I may be required to seek in-person care if my provider deems it necessary.
                        </p>
                        <div class="flex items-center space-x-2">
                            {{ form.virtual_care_consent }}
                            <label class="text-gray-700">I consent to receive virtual care services</label>
                        </div>
                    </div>

                    <div class="p-4 bg-white rounded-lg border border-gray-200">
                        <h3 class="font-semibold text-[#004d40] mb-2">Electronic Health Record Consent</h3>
                        <p class="text-gray-600 mb-4 text-sm">
                            I consent to the creation and maintenance of an electronic health record. I understand that my health information will be stored securely and accessed only by authorized healthcare personnel involved in my care.
                        </p>
                        <div class="flex items-center space-x-2">
                            {{ form.ehr_consent }}
                            <label class="text-gray-700">I consent to the use of Electronic Health Records</label>
                        </div>
                    </div>
                </div>
                
                <div class="mt-6 flex justify-between">
                    <button type="button" class="border border-[#004d40] text-[#004d40] px-6 py-2 rounded-lg hover:bg-gray-100 transition-all duration-200" onclick="prevSection(4)">
                        Previous
                    </button>
                    <button type="submit" class="bg-[#004d40] text-white px-6 py-2 rounded-lg hover:bg-[#00332e] transition-all duration-200">
                        Submit Registration
                    </button>
                </div>
            </div>
        </div>
    </form>
</div>

<script>
    // Auto-hide Success Message after 5 seconds
    setTimeout(function() {
        let successMessage = document.getElementById('success-message');
        if (successMessage) {
            successMessage.style.opacity = '0';
            setTimeout(() => successMessage.style.display = 'none', 500);
        }
    }, 5000);

    // Navigation between form sections
    const sections = 4;
    let currentSection = 1;
    
    function updateProgressBar() {
        const progressBar = document.getElementById('progress-bar');
        const progress = ((currentSection - 1) / (sections - 1)) * 100;
        progressBar.style.width = `${progress}%`;
    }
    
    function showSection(sectionNumber) {
        for (let i = 1; i <= sections; i++) {
            const section = document.getElementById(`section-${i}`);
            if (i === sectionNumber) {
                section.classList.remove('hidden');
            } else {
                section.classList.add('hidden');
            }
        }
        updateProgressBar();
    }
    
    function nextSection(current) {
        if (current < sections) {
            currentSection = current + 1;
            showSection(currentSection);
            window.scrollTo(0, 0);
        }
    }
    
    function prevSection(current) {
        if (current > 1) {
            currentSection = current - 1;
            showSection(currentSection);
            window.scrollTo(0, 0);
        }
    }
    
    // Initialize
    updateProgressBar();
</script>
{% endblock %}
