{% extends "patient/base.html" %}
{% block title %}View Message - Northern Health Innovations{% endblock %}
{% block content %}
<div class="flex justify-between items-center mb-6">
  <h2 class="text-xl font-bold text-gray-800">View Message</h2>
  <div class="flex space-x-2">
    <a href="{% if user.is_staff %}{% url 'provider_messages' %}{% else %}{% url 'patient:patient_messages' %}{% endif %}" class="text-[#004d40] hover:text-[#00332e] py-2 px-4 rounded-lg flex items-center">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 15l-3-3m0 0l3-3m-3 3h8M3 12a9 9 0 1118 0 9 9 0 01-18 0z" />
      </svg>
      Back to Messages
    </a>
  </div>
</div>

<div class="bg-white p-6 rounded-xl shadow mb-8">
  <!-- Message header -->
  <div class="border-b border-gray-200 pb-4 mb-4">
    <h3 class="text-lg font-medium text-gray-900">{{ message.subject|default:"No Subject" }}</h3>
    <div class="flex justify-between mt-2 text-sm text-gray-600">
      <div>
        <span class="font-medium">From:</span> {{ message.sender_name|default:"Unknown Sender" }}
      </div>
      <div>{{ message.created_at|date:"F j, Y, g:i a"|default:"Unknown date" }}</div>
    </div>
  </div>
  
  <!-- Message content -->
  <div class="prose max-w-none mb-6">
    <p>{{ message.content|linebreaks }}</p>
  </div>
  
  <!-- Message actions -->
  <div class="flex justify-end space-x-3 mt-6">
    <a href="{% if user.is_staff %}{% url 'provider_compose_message' %}{% else %}{% url 'patient:patient_compose_message' %}{% endif %}?reply_to={{ message.id }}" 
       class="inline-flex items-center px-4 py-2 border border-transparent rounded-md shadow-sm text-sm font-medium text-white bg-[#004d40] hover:bg-[#00332e] focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#004d40]">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6" />
      </svg>
      Reply
    </a>
    
    {% if message.status == 'read' %}
    <a href="{% if user.is_staff %}{% url 'provider_message_action' message.id 'mark_unread' %}{% else %}{% url 'patient:patient_message_action' message.id 'mark_unread' %}{% endif %}" 
       class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#004d40]">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z" />
      </svg>
      Mark as Unread
    </a>
    {% endif %}
    
    <a href="{% if user.is_staff %}{% url 'provider_message_action' message.id 'archive' %}{% else %}{% url 'patient:patient_message_action' message.id 'archive' %}{% endif %}" 
       class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#004d40]">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4" />
      </svg>
      Archive
    </a>
    
    <a href="{% if user.is_staff %}{% url 'provider_message_action' message.id 'delete' %}{% else %}{% url 'patient:patient_message_action' message.id 'delete' %}{% endif %}" 
       class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-md shadow-sm text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-[#004d40]"
       onclick="return confirm('Are you sure you want to delete this message?');">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" />
      </svg>
      Delete
    </a>
  </div>
</div>
{% endblock %}
